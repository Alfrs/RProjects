---
title: "Semana2_EDA"
output:
  word_document: default
  html_document:
    df_print: paged
---

<!-- SEMANA 2 --> 
<!-- SEMANA 2 --> 
<!-- SEMANA 2 --> 

# SEMANA 2

# Practica relacionada a visualizacion de algunos tipos de datos

## Base de datos:

## Los datos estan relacionados con las campa√±as de marketing directo, de una institucion bancaria. El objetivo es clasificar si el cliente se suscribira o no.

#### El dataset puede ser encontrado en: https://archive.ics.uci.edu/ml/datasets/Bank+Marketing

#### Importar los paquetes necesarios para todo el proceso de extraccion, limpieza y modelaje


```{r}
require(readr) #libreria necesaria para abrir archivos csv
library(dplyr) #libreria necesaria para manipular datos
require(ggplot2) #libreria necesaria para graficar
require(plotly) #libreria que generalmente toma un objeto de ggplot2 y lo convierte en una grafica dinamica
#install.packages("plotly")
```

#### Vamos a leer los datos

```{r}

setwd("C:/Users/alfrs/Documents/Test_1") #Esta funcion se utiliza para stear la direccion del ambiente de trabajo
#dataset <- read.csv("bank-full.csv") # Lee el archivo, esta no sirve porque el archivo esta separado por punto y coma
dataset <- read.csv("bank-full.csv", sep=";") # Ahora la funcion si funciona ya que le dimos un argumento mas el cual le dice a la funcion que separe las columnas por punto y coma
head(dataset,n=10) # sirve para ver los primeros datos del dataset
```

# La primera cosa que deberiamos hacer es revisar las estructuras de datos

```{r}

str(dataset)
#dataset$age <- as.numeric(dataset$age)
#lapply la otra semana

```

# veamos el resumen de la informacion

```{r}

summary(dataset)

```

#### Vamos a realizar graficos 
##### Cual es nuestra distribucion de edades?

```{r}

grafico_hist <- ggplot(data = dataset,aes(age,fill = y)) + 
                geom_histogram(bins = 30) + 
                ggtitle("Distribucion de Edades") + 
                theme(plot.title = element_text(hjust = 0.5)) +
                scale_x_continuous(breaks = seq(0,100,5))
ggplotly(grafico_hist)

```

# ver la proporcion de los datos con respecto a la variable Y

```{r}

prop.table(table(dataset$y))
# regularizacion L2 
# es un tipo de penalizacion en algoritmos de machine learning 
# que se utiliza para ayudar a solventar los problemas de proporcion

```

# Cual es la edad promedio entre YES & NO

```{r}

# Usando dplyr
dataset%>%
  select("age","y")%>%
  group_by(y)%>%
  summarise(age=mean(age))

dataset%>%
  select("day","y")%>%
  group_by(y)%>%
  summarise(day=mean(day))

```

# realizar un grafico de cajas para entender la varianza que existe entre las edades

```{r}

grafico_box1 <- ggplot(data = dataset,aes(y,age,fill=y)) + geom_boxplot()
ggplotly(grafico_box1)

```

### Realizar un subset de datos para determinar valores atipicos en la variable Y, seccionada por "Yes" & "No"

```{r}

comienzo <- Sys.time()
dataset_filtrado <- subset(dataset,y=="no")
termina <- Sys.time()
duracion <- termina - comienzo
duracion


comienzo <- Sys.time()
dataset_filtrado2 <- dataset%>%
  filter(y == "no")
termina <- Sys.time()
duracion <- termina - comienzo
duracion

```

<!-- SEMANA 3 --> 
<!-- SEMANA 3 --> 
<!-- SEMANA 3 --> 

# SEMANA 3

### Vamos a hacer una funcion para calcular

```{r}

eliminar_ati<-function(dataset_col){
  
  q1 <- quantile(dataset_col,probs = 0.25)
  q3 <- quantile(dataset_col,probs = 0.75)
  IQR = q3-q1
  
  bigote_alto <- q3 + (1.5 * IQR)
  
  return(bigote_alto)
  
}

calc_bigote_bajo <- function(dataset_col){
  
  q1 <- quantile(dataset_col,probs = 0.25)
  q3 <- quantile(dataset_col,probs = 0.75)
  IQR = q3-q1
  
  bigote_bajo <- q1 - (1.5 * IQR)
  
  return(bigote_bajo)
  
}

bigote_alto <- eliminar_ati(dataset_filtrado2$age)
bigote_bajo <- calc_bigote_bajo(dataset_filtrado2$age)

#dataset_ati_bigalto <- dataset_filtrado2 %>%
#  filter(age > bigote_alto)

dataset_fil <- dataset_filtrado2 %>%
  filter(age < bigote_alto)

dataset_fil2 <- dataset_fil %>%
  filter(age > bigote_bajo)

#dataset_fil


#ggplotly(ggplot(dataset_filtrado2,aes(y=age)) + geom_boxplot())
ggplotly(ggplot(dataset_fil2,aes(y=age)) + geom_boxplot())

#??quantile()

```

### Grafico de barras

```{r}

dataset %>%
  ggplot(aes(x = job, fill = y)) + 
  geom_bar(position = "fill") +
  theme(axis.text.x = element_text(size = 10, angle = 45, hjust = 1, vjust = 1),
        panel.background = element_blank(),
        plot.title = element_text(size = 25,face = "bold")) +
  labs(fill = "Suscribed") +
  ggtitle("Count of suscribed people per job")

#ggplotly(ggplot(dataset,aes(x = job, fill = y)) + 
#  geom_bar() +
#  theme(axis.text.x = element_text(size = 10, angle = 45, hjust = 1, vjust = 1)))

```

### Proceso de modelo ML

```{r}
# Step 1: Dividir los datos
# Train set & Test set
# Con Train entreno mi modelo
# Con Test compruebo mi modelo
# Dos condiciones
# Undefitting: Mi modelo generalizo mucho y no tiene mucho accuracy
# Overfitting: Mi modelo aprendio mi dataset pero no puede generalizar con otro dataset
library(caret)

set.seed(1993)

indexes <- createDataPartition(dataset$y,
                               times = 1,
                               p = 0.7,
                               list = FALSE)

train_set <- dataset[indexes,]
test_set <- dataset[-indexes,] # Todo lo que no este en indexes

```

```{r}
# Particiona el training set

cv.folds <- 

```






























